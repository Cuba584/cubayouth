<script>
$(document).ready(function(){
	$('iframe').each(function(i, el){
		$(el).attr('src', $(el).data("src"));
	});
});
</script>

<div class="container inner">

  <section id="top-fold">
				<div id="cinema-box">
        <video id="cinemagraph" data-autoplay autoplay muted playsinline>

          <source src="/assets/video/<%=body["cinemagraph"]["src"] %>" type="video/mp4">
          <!-- <source src="/assets/video/dorian_new.mp4" type="video/mp4"> -->
        </video>
		</div>
      <div>
		    <div id="title-box" class="center-wrapper">
		      <div class="<%= body["master-class"]["class"] %> change-bg" id="inner-title-box">
		        <h1><%=body["header"]["text"] %></h1>
		        <h3><%=body["header"]["subtitle"] %></h3>
		      </div>
		    </div>
    </div>

    <div class="byline-box center-wrapper">
      <div class="byline-item">
      <p class="byline-head">written by</p>
        <% for (r in body["reporters"]) {%>
        <p><%= body["reporters"][r]["name"] %></p>
        <% } %>
      </div>
      <div class="byline-item">
      <p class="byline-head">photos by</p>
        <% for (v in body["videographers"]) {%>
        <p><%= body["videographers"][v]["name"] %></p>
        <% } %>
      </div>
      <div class="byline-item">
      <p class="byline-head">design by</p>
        <% for (d in body["designers"]) {%>
        <p><%= body["designers"][d]["name"] %></p>
        <% } %>
      </div>
    </div>

  </section>

  <!-- <iframe src="https://player.vimeo.com/video/162564459" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="" data-aspectratio="0.562" style="width: 896px; height: 503.552px;"></iframe> -->

  <section class="center-wrapper">
    <div class="max-width">
    <% for (i in body["text"]) {
      if (body["text"][i]["type"] == "text") {%>
    <p> <%-body["text"][i]["value"] %> </p>
    <%} else if (body["text"][i]["type"] == "subhead") {%>
      <h4 class="subhead <%= body["master-class"]["class"] %>"><%=body["text"][i]["value"]["text"] %></h4>
    <%} else if (body["text"][i]["type"] == "video") {%>
      <div id="video-top"></div>
    </div>
  </section>
  <div class="vimeo-container">
      <div class="vimeo-wrapper" id="vimeo-wrap">
        <iframe data-src="https://player.vimeo.com/video/<%=body["text"][i]["value"]["id"]%>?title=0&byline=0&portrait=0" width="640" height="360" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
      </div>

    </div>
      <section class="center-wrapper">
        <div class="max-width">
					<%} else if (body["text"][i]["type"] == "slider"){%>
				</div>
				</section>
				<script>
				var captionArray = [];
				</script>
						<div id="photo-gallery">

						  <div id="custom-slider">

						    <ul id="slider-ul">
									<% for (s in body["slider-images"]){%>
							      <li class="slider-section">
							        <div class="pic-style">
							          <img src="../assets/images/photo-gallery/<%=body["master-class"]["class"]%>/<%=body["slider-images"][s]["src"]%>" class="pic"/>
							        </div>
							      </li>
										<script>
										captionArray.push("<figcaption class='pg-figcaption'>" +
											"<p class='fig-descr'><%=body['slider-images'][s]['caption']%></p>" +
											"<p class='fig-attr'>Photo by</p>" +
											"<p class='fig-attr'><%=body['slider-images'][s]['attribution']%></p>" +
										"</figcaption>");
										</script>
								<% } %>
							</ul>
						  </div>
							<!-- <script src="/js/slider.js"></script> -->

							<div class="caption">
								 <div class="arrow-wrapper">
									<button class="slider-left"><i class="fa fa-angle-left" aria-hidden="true"></i></button>
									<button class="slider-right"><i class="fa fa-angle-right" aria-hidden="true"></i></button>
								</div>
								<div id="inner-caption">
								</div>
						</div>
							</div>
						<script>
						var sliderSections = document.getElementsByClassName('slider-section');
						var slider = document.getElementById('custom-slider');
						var sliderUl = document.getElementById('slider-ul');
						var lastSlide= sliderUl.lastElementChild;
						var lastSlideClone = lastSlide.cloneNode(true);
						var firstSlide = sliderUl.firstElementChild;
						var firstSlideClone = firstSlide.cloneNode(true);
						sliderUl.style.width = 100 * (sliderSections.length + 2) + "%";
						sliderUl.insertBefore(lastSlideClone, firstSlide);
						sliderUl.appendChild(firstSlideClone);
						var leftButtons = document.getElementsByClassName('slider-left');
						var rightButton = document.getElementsByClassName('slider-right');
						var sliderLeft = sliderUl.offsetLeft;
						var slideIndex = 0;
						var captionIndex = 0;
						$('#inner-caption').html(captionArray[1]);



							$('.slider-left').on("click", function toPrevious() {
								sliderUl.style.transition = "0.5s left";
								slideIndex --;
								console.log(slideIndex)
								var captionIndex = slideIndex;
								if (slideIndex == 0) {
									sliderUl.style.left = "-110%";
								} else if (slideIndex == -1) {
									sliderUl.style.left = "-10%";
									setTimeout(function() {
										sliderUl.style.transition = "0s left";
										sliderUl.style.left = (sliderSections.length - 1) * -110 + '%';
										 slideIndex = sliderSections.length - 2;
										 console.log(slideIndex)
									}, 500);
								}
								else {
									sliderUl.style.left = (slideIndex * -110) - 110 + '%';
								}
								var currentCaption = captionArray[captionIndex +1];
								$('#inner-caption').html(currentCaption);
							})



							$('.slider-right').on("click", function toNext() {
								sliderUl.style.transition = "0.5s left";
								slideIndex ++;
								console.log(slideIndex)
								captionIndex = slideIndex;
								if (slideIndex == 0) {
									sliderUl.style.left = "-110%";
								}
								else if (slideIndex > sliderSections.length - 2) {
									sliderUl.style.left = (slideIndex * -110) - 110 + '%';
									setTimeout(function() {
										sliderUl.style.transition = "0s left";
										sliderUl.style.left = "-110%";
										 slideIndex = 0;
										 console.log(slideIndex);
									}, 500);
									captionIndex = 0;
								}
								else {
									sliderUl.style.left = (slideIndex * -110) - 110 + '%';
								}
								console.log(captionIndex + 1)
								var currentCaption = captionArray[captionIndex +1];
								console.log(currentCaption)
								$('#inner-caption').html(currentCaption);
							})

						</script>
				<section class="center-wrapper">
					<div class="max-width">
      <%} else if (body["text"][i]["type"] == "interactive") {%>
      </div>
    </section>

    <% var filepath = body["text"][i]["value"]["filename"] %>
      <%- include(filepath); %>
           <section class="center-wrapper">
             <div class="max-width">

    <% } else if (body["text"][i]["type"] == "pullquote") {%>

    </div>
  </section>
    <div class="pull-quote-box change-bg <%= body["master-class"]["class"] %>">
      <h3 class="pull-quote">
        <hr> <span><%=body["text"][i]["value"]["text"] %></span> </h3>
    </div>
    <section class="center-wrapper">
      <div class="max-width">
    <% } else if (body["text"][i]["type"] == "image") { %>
    </div>
  </section>
    <figure>
      <img class="inner-image" src='assets/images/<%=body["text"][i]["value"]["src"] %> ' alt='
      <%=body["text"][i]["value"]["alt"] %>'>
      <figcaption>
      <p class="fig-descr"><%=body["text"][i]["value"]["caption"] %></p>
      <p class="fig-attr">Photo by</p>
      <p class="fig-attr"><%=body["text"][i]["value"]["attribution"] %></p>
    </figcaption>
    </figure>
      <section class="center-wrapper">
        <div class="max-width">

		<% } else if (body["text"][i]["type"] == "map") { %>
			<div class="center-wrapper">
				<img class="map" src='assets/images/<%=body["text"][i]["value"]["src"] %> ' alt='
				<%=body["text"][i]["value"]["alt"] %>'>
			</div>
		<%} } %>

  </div>
  </section>
